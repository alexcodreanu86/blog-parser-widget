!function(a){"use strict";window.namespace=function(b,c){for(var d,e=window,f=b.split(".");d=f.shift();)e[d]=e[d]||{},e=e[d];a.extend(e,c)}}(window._),function(){namespace("Blog"),Blog.Controller=function(){function a(){}return a.widgets=[],a.getWidgets=function(){return this.widgets},a.setupWidgetIn=function(a){var b;return b=new Blog.Widgets.Controller(a),b.initialize(),this.addWidgetToContainer(b)},a.addWidgetToContainer=function(a){return this.widgets.push(a)},a.exitEditMode=function(){return this.allActiveWidgetsExecute("exitEditMode")},a.enterEditMode=function(){return this.allActiveWidgetsExecute("enterEditMode")},a.allActiveWidgetsExecute=function(a){return _.each(this.widgets,function(){return function(b){return b.isActive()?b[a]():void 0}}(this))},a}()}.call(this),function(){namespace("Blog"),Blog.Display=function(){function a(){}return a.generateLogo=function(a){return'<i class="fa fa-book '+a["class"]+'" data-id="'+a.dataId+'"></i>'},a}()}.call(this),function(){namespace("Blog.Widgets"),Blog.Widgets.Api=function(){function a(){}return a.getBlogPosts=function(a,b){var c;return c=JSON.stringify({url:a}),$.post("/blog_feed",c,function(a){return b.showPosts(a)},"json")},a}()}.call(this),function(){namespace("Blog.Widgets"),Blog.Widgets.Controller=function(){function a(a){this.container=a.container,this.defaultValue=a.defaultValue,this.display=new Blog.Widgets.Display(a.container,a.numberOfPosts,a.animationSpeed),this.refreshRate=a.refreshRate,this.activeStatus=!1}return a.prototype.getContainer=function(){return this.container},a.prototype.initialize=function(){return this.display.setupWidget(),this.bind(),this.setAsActive(),this.displayDefault()},a.prototype.bind=function(){return $(""+this.container+" [data-id=blog-button]").click(function(a){return function(){return a.processClickedButton()}}(this)),$(""+this.container+" [data-id=blog-close]").click(function(a){return function(){return a.closeWidget()}}(this))},a.prototype.unbind=function(){return $(""+this.container+" [data-id=blog-button]").unbind("click"),$(""+this.container+" [data-id=blog-close]").unbind("click")},a.prototype.closeWidget=function(){return this.display.removeWidget(),this.setAsInactive(),this.unbind()},a.prototype.processClickedButton=function(){var a;return a=this.display.getInput(),Blog.Widgets.Validator.isValidUrl(a)?this.getBlogPosts(a):void 0},a.prototype.getBlogPosts=function(a){return Blog.Widgets.Api.getBlogPosts(a,this.display),this.refreshRate?(this.clearCurrentTimeout(),this.refreshBlogPosts(a)):void 0},a.prototype.clearCurrentTimeout=function(){return this.timeout?clearTimeout(this.timeout):void 0},a.prototype.refreshBlogPosts=function(a){return this.timeout=setTimeout(function(b){return function(){return b.isActive()?b.getBlogPosts(a):void 0}}(this),this.refreshSeconds())},a.prototype.refreshSeconds=function(){return 1e3*this.refreshRate},a.prototype.displayDefault=function(){return this.defaultValue?this.getBlogPosts(this.defaultValue):void 0},a.prototype.isActive=function(){return this.activeStatus},a.prototype.setAsActive=function(){return this.activeStatus=!0},a.prototype.setAsInactive=function(){return this.activeStatus=!1},a.prototype.exitEditMode=function(){return this.display.exitEditMode()},a.prototype.enterEditMode=function(){return this.display.enterEditMode()},a}()}.call(this),function(){namespace("Blog.Widgets"),Blog.Widgets.Display=function(){function a(a,b,c){this.container=a,this.numberOfPosts=b,this.animationSpeed=c}return a.prototype.setupWidget=function(){var a;return a=Blog.Widgets.Templates.renderForm(),$(this.container).append(a)},a.prototype.getInput=function(){return $(""+this.container+" [name=blog-search]").val()},a.prototype.showPosts=function(a){var b,c;return b=this.formatAllPosts(a),c=Blog.Widgets.Templates.renderPosts(b,this.numberOfPosts),$(""+this.container+" [data-id=blog-output]").html(c)},a.prototype.formatAllPosts=function(a){return _.map(a,function(a){return function(b){return a.formatPost(b)}}(this))},a.prototype.formatPost=function(a){var b;return b={},b.title=a.title,b.authorName=a.author,b.blogLink=a.link,b.imageSrc=a.image.url||"https://pbs.twimg.com/profile_images/1378895288/twitter-logo_400x400.png",b.imageAlt=a.image.title,b},a.prototype.removeWidget=function(){return $(this.container).remove()},a.prototype.exitEditMode=function(){return this.hideForm(),this.hideCloseWidgetButton()},a.prototype.hideForm=function(){return $(""+this.container+" [data-id=blog-form]").hide(this.animationSpeed)},a.prototype.hideCloseWidgetButton=function(){return $(""+this.container+" [data-id=blog-close]").hide(this.animationSpeed)},a.prototype.enterEditMode=function(){return this.showForm(),this.showCloseWidgetButton()},a.prototype.showForm=function(){return $(""+this.container+" [data-id=blog-form]").show(this.animationSpeed)},a.prototype.showCloseWidgetButton=function(){return $(""+this.container+" [data-id=blog-close]").show(this.animationSpeed)},a}()}.call(this),function(){namespace("Blog.Widgets"),Blog.Widgets.Templates=function(){function a(){}return a.renderForm=function(){return _.template('<div class="widget" data-id="blog-widget-wrapper">\n  <div class="widget-header">\n    <h2 class="widget-title">Blog Posts</h2>\n    <span class=\'widget-close\' data-id=\'blog-close\'>Ã—</span>\n      <div class="widget-form" data-id="blog-form">\n        <input name="blog-search" type="text" autofocus="true">\n        <button id="blog" data-id="blog-button">Search blog</button><br>\n      </div>\n    </div>\n  <div class="widget-body" data-id="blog-output"></div>\n</div>')},a.renderPosts=function(a,b){return null==b&&(b=a.length),b>a.length&&(b=a.length),_.template('<% for (var i = 0; i < numberOfPosts; i++){ %>\n  <div class="blog-post">\n    <div class="blog-image-container">\n      <img class="blog-image" src="<%= posts[i].imageSrc %>" alt="<%= posts[i].imageAlt %>"/>\n    </div>\n    <div class="blog-information">\n    <h3 class="blog-post-title"><%= posts[i].title %></h3>\n    <p><a class="post-author-name" href="<%= posts[i].blogLink %>"><%= posts[i].authorName %></a></p>\n    </div>\n  </div>\n<% } %>',{posts:a,numberOfPosts:b})},a}()}.call(this),function(){namespace("Blog.Widgets"),Blog.Widgets.Validator=function(){function a(){}return a.isValidUrl=function(a){return new Boolean(this.matchUrl(a))},a.matchUrl=function(a){return a.match(/http\:\/\/\w+\.\w+/)},a}()}.call(this),function(){namespace("Blog.Widgets"),Blog.Widgets.Validator=function(){function a(){}return a.isValidUrl=function(a){return!!this.matchUrl(a)},a.matchUrl=function(a){return a.match(/http\:\/\/\w+\.\w+/)},a}()}.call(this);